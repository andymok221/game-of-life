!function(b,c,d,e){c[b]=d.call(c);for(var f=0;f<e.length;f++)e[f](c[b]);"undefined"!=typeof module&&module.exports?module.exports=c[b]:"function"==typeof define&&define.amd&&define(function(){return c[b]})}("Primus",this||{},function(){var b;return function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);var j=new Error("Cannot find module '"+g+"'");throw j.code="MODULE_NOT_FOUND",j}var k=c[g]={exports:{}};b[g][0].call(k.exports,function(a){var c=b[g][1][a];return e(c||a)},k,k.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b,c){"use strict";b.exports=function(b,c){function e(a,b){if(c[a]){if("string"==typeof c[a]&&(c[a]=c[a].split(d)),"function"==typeof c[a])return c[a].call(b);for(var f,g,e=0;e<c[a].length;e++)g=c[a][e],f=typeof g,"function"===f?g.call(b):"string"===f&&"function"==typeof b[g]&&b[g]()}}var d=/[, ]+/;return c=c||{},b=b||[],"string"==typeof b&&(b=b.split(d)),function(){var f,c=this,d=0;if(null===c[b[0]])return!1;for(e("before",c);d<b.length;d++)f=b[d],c[f]&&("function"==typeof c[f].destroy&&c[f].destroy(),c[f]=null);return c.emit&&c.emit("destroy"),e("after",c),!0}}},{}],2:[function(a,b,c){"use strict";b.exports=function(){for(var c,b=this,d=0,e=arguments.length,f=new Array(e);d<e;d++)f[d]=arguments[d];return"function"!=typeof f[f.length-1]?function(){for(var c=0,d=arguments.length,e=new Array(d);c<d;c++)e[c]=arguments[c];return b.emit.apply(b,f.concat(e))}:(c=f.pop(),function(){for(var d=0,e=arguments.length,g=new Array(e+1);d<e;d++)g[d+1]=arguments[d];return g[0]=function(c,d){if(c)return b.emit("error",c);g=void 0===d?g.slice(1):null===d?[]:d,b.emit.apply(b,f.concat(g))},c.apply(b,g),!0})}},{}],3:[function(a,b,c){"use strict";function f(){}function g(a,b,c){this.fn=a,this.context=b,this.once=c||!1}function h(){this._events=new f,this._eventsCount=0}var d=Object.prototype.hasOwnProperty,e="~";Object.create&&(f.prototype=Object.create(null),(new f).__proto__||(e=!1)),h.prototype.eventNames=function(){var c,f,b=[];if(0===this._eventsCount)return b;for(f in c=this._events)d.call(c,f)&&b.push(e?f.slice(1):f);return Object.getOwnPropertySymbols?b.concat(Object.getOwnPropertySymbols(c)):b},h.prototype.listeners=function(b,c){var d=e?e+b:b,f=this._events[d];if(c)return!!f;if(!f)return[];if(f.fn)return[f.fn];for(var g=0,h=f.length,i=new Array(h);g<h;g++)i[g]=f[g].fn;return i},h.prototype.emit=function(b,c,d,f,g,h){var i=e?e+b:b;if(!this._events[i])return!1;var l,m,j=this._events[i],k=arguments.length;if(j.fn){switch(j.once&&this.removeListener(b,j.fn,void 0,!0),k){case 1:return j.fn.call(j.context),!0;case 2:return j.fn.call(j.context,c),!0;case 3:return j.fn.call(j.context,c,d),!0;case 4:return j.fn.call(j.context,c,d,f),!0;case 5:return j.fn.call(j.context,c,d,f,g),!0;case 6:return j.fn.call(j.context,c,d,f,g,h),!0}for(m=1,l=new Array(k-1);m<k;m++)l[m-1]=arguments[m];j.fn.apply(j.context,l)}else{var o,n=j.length;for(m=0;m<n;m++)switch(j[m].once&&this.removeListener(b,j[m].fn,void 0,!0),k){case 1:j[m].fn.call(j[m].context);break;case 2:j[m].fn.call(j[m].context,c);break;case 3:j[m].fn.call(j[m].context,c,d);break;case 4:j[m].fn.call(j[m].context,c,d,f);break;default:if(!l)for(o=1,l=new Array(k-1);o<k;o++)l[o-1]=arguments[o];j[m].fn.apply(j[m].context,l)}}return!0},h.prototype.on=function(b,c,d){var f=new g(c,d||this),h=e?e+b:b;return this._events[h]?this._events[h].fn?this._events[h]=[this._events[h],f]:this._events[h].push(f):(this._events[h]=f,this._eventsCount++),this},h.prototype.once=function(b,c,d){var f=new g(c,d||this,!0),h=e?e+b:b;return this._events[h]?this._events[h].fn?this._events[h]=[this._events[h],f]:this._events[h].push(f):(this._events[h]=f,this._eventsCount++),this},h.prototype.removeListener=function(b,c,d,g){var h=e?e+b:b;if(!this._events[h])return this;if(!c)return 0==--this._eventsCount?this._events=new f:delete this._events[h],this;var i=this._events[h];if(i.fn)i.fn!==c||g&&!i.once||d&&i.context!==d||(0==--this._eventsCount?this._events=new f:delete this._events[h]);else{for(var j=0,k=[],l=i.length;j<l;j++)(i[j].fn!==c||g&&!i[j].once||d&&i[j].context!==d)&&k.push(i[j]);k.length?this._events[h]=1===k.length?k[0]:k:0==--this._eventsCount?this._events=new f:delete this._events[h]}return this},h.prototype.removeAllListeners=function(b){var c;return b?(c=e?e+b:b,this._events[c]&&(0==--this._eventsCount?this._events=new f:delete this._events[c])):(this._events=new f,this._eventsCount=0),this},h.prototype.off=h.prototype.removeListener,h.prototype.addListener=h.prototype.on,h.prototype.setMaxListeners=function(){return this},h.prefixed=e,h.EventEmitter=h,void 0!==b&&(b.exports=h)},{}],4:[function(a,b,c){"function"==typeof Object.create?b.exports=function(b,c){b.super_=c,b.prototype=Object.create(c.prototype,{constructor:{value:b,enumerable:!1,writable:!0,configurable:!0}})}:b.exports=function(b,c){b.super_=c;var d=function(){};d.prototype=c.prototype,b.prototype=new d,b.prototype.constructor=b}},{}],5:[function(a,b,c){"use strict";var d=new RegExp("^((?:\\d+)?\\.?\\d+) *("+["milliseconds?","msecs?","ms","seconds?","secs?","s","minutes?","mins?","m","hours?","hrs?","h","days?","d","weeks?","wks?","w","years?","yrs?","y"].join("|")+")?$","i"),e=1e3,f=60*e,g=60*f,h=24*g,i=7*h,j=365*h;b.exports=function(b){var k,l,c=typeof b;if("number"===c)return b;if("string"!==c||"0"===b||!b)return 0;if(+b)return+b;if(b.length>1e4||!(l=d.exec(b)))return 0;switch(k=parseFloat(l[1]),l[2].toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return k*j;case"weeks":case"week":case"wks":case"wk":case"w":return k*i;case"days":case"day":case"d":return k*h;case"hours":case"hour":case"hrs":case"hr":case"h":return k*g;case"minutes":case"minute":case"mins":case"min":case"m":return k*f;case"seconds":case"second":case"secs":case"sec":case"s":return k*e;default:return k}}},{}],6:[function(a,b,c){"use strict";b.exports=function(b){function e(){return c?d:(c=1,d=b.apply(this,arguments),b=null,d)}var d,c=0;return e.displayName=b.displayName||b.name||e.displayName||e.name,e}},{}],7:[function(a,b,c){"use strict";function e(a){return decodeURIComponent(a.replace(/\+/g," "))}function f(a){for(var d,b=/([^=?&]+)=?([^&]*)/g,c={};d=b.exec(a);c[e(d[1])]=e(d[2]));return c}function g(a,b){b=b||"";var c=[];"string"!=typeof b&&(b="?");for(var e in a)d.call(a,e)&&c.push(encodeURIComponent(e)+"="+encodeURIComponent(a[e]));return c.length?b+c.join("&"):""}var d=Object.prototype.hasOwnProperty;c.stringify=g,c.parse=f},{}],8:[function(a,b,c){"use strict";function i(a,b,c){return e(a in c?c[a]:a in b?b[a]:j[a])}function j(a){var b=this;if(!(b instanceof j))return new j(a);a=a||{},b.attempt=null,b._fn=null,b["reconnect timeout"]=i("reconnect timeout",b,a),b.retries=i("retries",b,a),b.factor=i("factor",b,a),b.max=i("max",b,a),b.min=i("min",b,a),b.timers=new g(b)}var d=a("eventemitter3"),e=a("millisecond"),f=a("demolish"),g=a("tick-tock"),h=a("one-time");j.prototype=new d,j.prototype.constructor=j,j["reconnect timeout"]="30 seconds",j.max=1/0,j.min="500 ms",j.retries=10,j.factor=2,j.prototype.reconnect=function(){var b=this;return b.backoff(function(c,d){if(d.duration=+new Date-d.start,c)return b.emit("reconnect failed",c,d);b.emit("reconnected",d)},b.attempt)},j.prototype.backoff=function(b,c){var d=this;return c=c||d.attempt||{},c.backoff?d:(c["reconnect timeout"]=i("reconnect timeout",d,c),c.retries=i("retries",d,c),c.factor=i("factor",d,c),c.max=i("max",d,c),c.min=i("min",d,c),c.start=+c.start||+new Date,c.duration=+c.duration||0,c.attempt=+c.attempt||0,c.attempt===c.retries?(b.call(d,new Error("Unable to recover"),c),d):(c.backoff=!0,c.attempt++,d.attempt=c,c.scheduled=1!==c.attempt?Math.min(Math.round((Math.random()+1)*c.min*Math.pow(c.factor,c.attempt-1)),c.max):c.min,d.timers.setTimeout("reconnect",function(){c.duration=+new Date-c.start,c.backoff=!1,d.timers.clear("reconnect, timeout");var e=d._fn=h(function(e){if(d.reset(),e)return d.backoff(b,c);b.call(d,void 0,c)});d.emit("reconnect",c,e),d.timers.setTimeout("timeout",function(){var b=new Error("Failed to reconnect in a timely manner");c.duration=+new Date-c.start,d.emit("reconnect timeout",b,c),e(b)},c["reconnect timeout"])},c.scheduled),d.emit("reconnect scheduled",c),d))},j.prototype.reconnecting=function(){return!!this.attempt},j.prototype.reconnected=function(b){return this._fn&&this._fn(b),this},j.prototype.reset=function(){return this._fn=this.attempt=null,this.timers.clear("reconnect, timeout"),this},j.prototype.destroy=f("timers attempt _fn"),b.exports=j},{demolish:1,eventemitter3:9,millisecond:5,"one-time":6,"tick-tock":11}],9:[function(a,b,c){"use strict";function e(a,b,c){this.fn=a,this.context=b,this.once=c||!1}function f(){}var d="function"!=typeof Object.create&&"~";f.prototype._events=void 0,f.prototype.listeners=function(b,c){var e=d?d+b:b,f=this._events&&this._events[e];if(c)return!!f;if(!f)return[];if(f.fn)return[f.fn];for(var g=0,h=f.length,i=new Array(h);g<h;g++)i[g]=f[g].fn;return i},f.prototype.emit=function(b,c,e,f,g,h){var i=d?d+b:b;if(!this._events||!this._events[i])return!1;var l,m,j=this._events[i],k=arguments.length;if("function"==typeof j.fn){switch(j.once&&this.removeListener(b,j.fn,void 0,!0),k){case 1:return j.fn.call(j.context),!0;case 2:return j.fn.call(j.context,c),!0;case 3:return j.fn.call(j.context,c,e),!0;case 4:return j.fn.call(j.context,c,e,f),!0;case 5:return j.fn.call(j.context,c,e,f,g),!0;case 6:return j.fn.call(j.context,c,e,f,g,h),!0}for(m=1,l=new Array(k-1);m<k;m++)l[m-1]=arguments[m];j.fn.apply(j.context,l)}else{var o,n=j.length;for(m=0;m<n;m++)switch(j[m].once&&this.removeListener(b,j[m].fn,void 0,!0),k){case 1:j[m].fn.call(j[m].context);break;case 2:j[m].fn.call(j[m].context,c);break;case 3:j[m].fn.call(j[m].context,c,e);break;default:if(!l)for(o=1,l=new Array(k-1);o<k;o++)l[o-1]=arguments[o];j[m].fn.apply(j[m].context,l)}}return!0},f.prototype.on=function(b,c,f){var g=new e(c,f||this),h=d?d+b:b;return this._events||(this._events=d?{}:Object.create(null)),this._events[h]?this._events[h].fn?this._events[h]=[this._events[h],g]:this._events[h].push(g):this._events[h]=g,this},f.prototype.once=function(b,c,f){var g=new e(c,f||this,!0),h=d?d+b:b;return this._events||(this._events=d?{}:Object.create(null)),this._events[h]?this._events[h].fn?this._events[h]=[this._events[h],g]:this._events[h].push(g):this._events[h]=g,this},f.prototype.removeListener=function(b,c,e,f){var g=d?d+b:b;if(!this._events||!this._events[g])return this;var h=this._events[g],i=[];if(c)if(h.fn)(h.fn!==c||f&&!h.once||e&&h.context!==e)&&i.push(h);else for(var j=0,k=h.length;j<k;j++)(h[j].fn!==c||f&&!h[j].once||e&&h[j].context!==e)&&i.push(h[j]);return i.length?this._events[g]=1===i.length?i[0]:i:delete this._events[g],this},f.prototype.removeAllListeners=function(b){return this._events?(b?delete this._events[d?d+b:b]:this._events=d?{}:Object.create(null),this):this},f.prototype.off=f.prototype.removeListener,f.prototype.addListener=f.prototype.on,f.prototype.setMaxListeners=function(){return this},f.prefixed=d,void 0!==b&&(b.exports=f)},{}],10:[function(a,b,c){"use strict";b.exports=function(b,c){if(c=c.split(":")[0],!(b=+b))return!1;switch(c){case"http":case"ws":return 80!==b;case"https":case"wss":return 443!==b;case"ftp":return 21!==b;case"gopher":return 70!==b;case"file":return!1}return 0!==b}},{}],11:[function(a,b,c){"use strict";function f(a,b,c,d){this.start=+new Date,this.duration=c,this.clear=b,this.timer=a,this.fns=[d]}function g(a){clearTimeout(a)}function h(a){clearInterval(a)}function i(a){clearImmediate(a)}function j(a){if(!(this instanceof j))return new j(a);this.timers={},this.context=a||this}var d=Object.prototype.hasOwnProperty,e=a("millisecond");f.prototype.remaining=function(){return this.duration-this.taken()},f.prototype.taken=function(){return+new Date-this.start},j.prototype.tock=function(b,c){var d=this;return function(){if(b in d.timers){var e=d.timers[b],f=e.fns.slice(),g=f.length,h=0;for(c?d.clear(b):d.start=+new Date;h<g;h++)f[h].call(d.context)}}},j.prototype.setTimeout=function(b,c,d){var i,h=this;return h.timers[b]?(h.timers[b].fns.push(c),h):(i=e(d),h.timers[b]=new f(setTimeout(h.tock(b,!0),e(d)),g,i,c),h)},j.prototype.setInterval=function(b,c,d){var i,g=this;return g.timers[b]?(g.timers[b].fns.push(c),g):(i=e(d),g.timers[b]=new f(setInterval(g.tock(b),e(d)),h,i,c),g)},j.prototype.setImmediate=function(b,c){var d=this;return"function"!=typeof setImmediate?d.setTimeout(b,c,0):d.timers[b]?(d.timers[b].fns.push(c),d):(d.timers[b]=new f(setImmediate(d.tock(b,!0)),i,0,c),d)},j.prototype.active=function(b){return b in this.timers},j.prototype.clear=function(){var e,f,g,b=arguments.length?arguments:[],c=this;if(1===b.length&&"string"==typeof b[0]&&(b=b[0].split(/[, ]+/)),!b.length)for(e in c.timers)d.call(c.timers,e)&&b.push(e);for(f=0,g=b.length;f<g;f++)(e=c.timers[b[f]])&&(e.clear(e.timer),e.fns=e.timer=e.clear=null,delete c.timers[b[f]]);return c},j.prototype.adjust=function(b,c){var d,f=this,g=e(c),i=f.timers[b];return i?(d=i.clear===h,i.clear(i.timer),i.start=+new Date,i.duration=g,i.timer=(d?setInterval:setTimeout)(f.tock(b,!d),g),f):f},j.prototype.end=j.prototype.destroy=function(){return!!this.context&&(this.clear(),this.context=this.timers=null,!0)},j.Timer=f,b.exports=j},{millisecond:5}],12:[function(a,b,c){"use strict";function i(a){var b=g.exec(a);return{protocol:b[1]?b[1].toLowerCase():"",slashes:!!b[2],rest:b[3]}}function j(a,b){for(var c=(b||"/").split("/").slice(0,-1).concat(a.split("/")),d=c.length,e=c[d-1],f=!1,g=0;d--;)"."===c[d]?c.splice(d,1):".."===c[d]?(c.splice(d,1),g++):g&&(0===d&&(f=!0),c.splice(d,1),g--);return f&&c.unshift(""),"."!==e&&".."!==e||c.push(""),c.join("/")}function k(a,b,c){if(!(this instanceof k))return new k(a,b,c);var g,l,m,n,o,p,q=h.slice(),r=typeof b,s=this,t=0;for("object"!==r&&"string"!==r&&(c=b,b=null),c&&"function"!=typeof c&&(c=f.parse),b=e(b),l=i(a||""),g=!l.protocol&&!l.slashes,s.slashes=l.slashes||g&&b.slashes,s.protocol=l.protocol||b.protocol||"",a=l.rest,l.slashes||(q[2]=[/(.*)/,"pathname"]);t<q.length;t++)n=q[t],m=n[0],p=n[1],m!==m?s[p]=a:"string"==typeof m?~(o=a.indexOf(m))&&("number"==typeof n[2]?(s[p]=a.slice(0,o),a=a.slice(o+n[2])):(s[p]=a.slice(o),a=a.slice(0,o))):(o=m.exec(a))&&(s[p]=o[1],a=a.slice(0,o.index)),s[p]=s[p]||(g&&n[3]?b[p]||"":""),n[4]&&(s[p]=s[p].toLowerCase());c&&(s.query=c(s.query)),g&&b.slashes&&"/"!==s.pathname.charAt(0)&&(""!==s.pathname||""!==b.pathname)&&(s.pathname=j(s.pathname,b.pathname)),d(s.port,s.protocol)||(s.host=s.hostname,s.port=""),s.username=s.password="",s.auth&&(n=s.auth.split(":"),s.username=n[0]||"",s.password=n[1]||""),s.origin=s.protocol&&s.host&&"file:"!==s.protocol?s.protocol+"//"+s.host:"null",s.href=s.toString()}function l(a,b,c){var e=this;switch(a){case"query":"string"==typeof b&&b.length&&(b=(c||f.parse)(b)),e[a]=b;break;case"port":e[a]=b,d(b,e.protocol)?b&&(e.host=e.hostname+":"+b):(e.host=e.hostname,e[a]="");break;case"hostname":e[a]=b,e.port&&(b+=":"+e.port),e.host=b;break;case"host":e[a]=b,/:\d+$/.test(b)?(b=b.split(":"),e.port=b.pop(),e.hostname=b.join(":")):(e.hostname=b,e.port="");break;case"protocol":e.protocol=b.toLowerCase(),e.slashes=!c;break;case"pathname":e.pathname=b.length&&"/"!==b.charAt(0)?"/"+b:b;break;default:e[a]=b}for(var g=0;g<h.length;g++){var i=h[g];i[4]&&(e[i[1]]=e[i[1]].toLowerCase())}return e.origin=e.protocol&&e.host&&"file:"!==e.protocol?e.protocol+"//"+e.host:"null",e.href=e.toString(),e}function m(a){a&&"function"==typeof a||(a=f.stringify);var b,c=this,d=c.protocol;d&&":"!==d.charAt(d.length-1)&&(d+=":");var e=d+(c.slashes?"//":"");return c.username&&(e+=c.username,c.password&&(e+=":"+c.password),e+="@"),e+=c.host+c.pathname,b="object"==typeof c.query?a(c.query):c.query,b&&(e+="?"!==b.charAt(0)?"?"+b:b),c.hash&&(e+=c.hash),e}var d=a("requires-port"),e=a("./lolcation"),f=a("querystringify"),g=/^([a-z][a-z0-9.+-]*:)?(\/\/)?([\S\s]*)/i,h=[["#","hash"],["?","query"],["/","pathname"],["@","auth",1],[NaN,"host",void 0,1,1],[/:(\d+)$/,"port",void 0,1],[NaN,"hostname",void 0,1,1]];k.prototype={set:l,toString:m},k.extractProtocol=i,k.location=e,k.qs=f,b.exports=k},{"./lolcation":13,querystringify:14,"requires-port":10}],13:[function(a,b,c){(function(c){"use strict";var f,d=/^[A-Za-z][A-Za-z0-9+-.]*:\/\//,e={hash:1,query:1};b.exports=function(g){g=g||c.location||{},f=f||a("./");var j,h={},i=typeof g;if("blob:"===g.protocol)h=new f(unescape(g.pathname),{});else if("string"===i){h=new f(g,{});for(j in e)delete h[j]}else if("object"===i){for(j in g)j in e||(h[j]=g[j]);void 0===h.slashes&&(h.slashes=d.test(g.href))}return h}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./":12}],14:[function(a,b,c){"use strict";function e(a){for(var d,b=/([^=?&]+)=?([^&]*)/g,c={};d=b.exec(a);c[decodeURIComponent(d[1])]=decodeURIComponent(d[2]));return c}function f(a,b){b=b||"";var c=[];"string"!=typeof b&&(b="?");for(var e in a)d.call(a,e)&&c.push(encodeURIComponent(e)+"="+encodeURIComponent(a[e]));return c.length?b+c.join("&"):""}var d=Object.prototype.hasOwnProperty;c.stringify=f,c.parse=e},{}],15:[function(a,b,c){"use strict";function j(a){var b="";do{b=d[a%e]+b,a=Math.floor(a/e)}while(a>0);return b}function k(a){var b=0;for(h=0;h<a.length;h++)b=b*e+f[a.charAt(h)];return b}function l(){var a=j(+new Date);return a!==i?(g=0,i=a):a+"."+j(g++)}for(var i,d="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_".split(""),e=64,f={},g=0,h=0;h<e;h++)f[d[h]]=h;l.encode=j,l.decode=k,b.exports=l},{}],16:[function(a,c,d){"use strict";function n(a,b){if(!(a instanceof p)){var c=new Error("Primus#"+b+"'s context should called with a Primus instance");if("function"!=typeof a.listeners||!a.listeners("error").length)throw c;a.emit("error",c)}}function p(a,b){if(!(this instanceof p))return new p(a,b);if(p.Stream.call(this),"function"!=typeof this.client)return this.critical(new Error("The client library has not been compiled correctly, see https://github.com/primus/primus#client-library for more details"));if("object"==typeof a?(b=a,a=b.url||b.uri||o):b=b||{},"ping"in b||"pong"in b)return this.critical(new Error("The `ping` and `pong` options have been removed"));var c=this;b.queueSize="queueSize"in b?b.queueSize:1/0,b.timeout="timeout"in b?b.timeout:1e4,b.reconnect="reconnect"in b?b.reconnect:{},b.pingTimeout="pingTimeout"in b?b.pingTimeout:45e3,b.strategy="strategy"in b?b.strategy:[],b.transport="transport"in b?b.transport:{},c.buffer=[],c.writable=!0,c.readable=!0,c.url=c.parse(a||o),c.readyState=p.CLOSED,c.options=b,c.timers=new f(this),c.socket=null,c.latency=0,c.disconnect=!1,c.transport=b.transport,c.transformers={outgoing:[],incoming:[]},c.recovery=new g(b.reconnect),"string"==typeof b.strategy&&(b.strategy=b.strategy.split(/\s?\,\s?/g)),!1===b.strategy?b.strategy=[]:b.strategy.length||(b.strategy.push("disconnect","online"),this.authorization||b.strategy.push("timeout")),b.strategy=b.strategy.join(",").toLowerCase(),"websockets"in b&&(c.AVOID_WEBSOCKETS=!b.websockets),"network"in b&&(c.NETWORK_EVENTS=b.network),b.manual||c.timers.setTimeout("open",function(){c.timers.clear("open"),c.open()},0),c.initialise(b)}var o,e=a("eventemitter3"),f=a("tick-tock"),g=a("recovery"),h=a("querystringify"),i=a("inherits"),j=a("demolish"),k=a("yeast"),l=/\u2028/g,m=/\u2029/g;try{o=location.origin?location.origin:location.protocol+"//"+location.host}catch(a){o="http://127.0.0.1"}p.requires=p.require=function(d){if("function"==typeof a)return"function"==typeof b&&b.amd?void 0:a(d)};try{p.Stream=p.requires("stream")}catch(a){}p.Stream||(p.Stream=e),i(p,p.Stream),p.OPENING=1,p.CLOSED=2,p.OPEN=3,p.prototype.AVOID_WEBSOCKETS=!1,p.prototype.NETWORK_EVENTS=!1,p.prototype.online=!0;try{(p.prototype.NETWORK_EVENTS="onLine"in navigator&&(window.addEventListener||document.body.attachEvent))&&(navigator.onLine||(p.prototype.online=!1))}catch(a){}if(p.prototype.ark={},p.prototype.emits=a("emits"),p.prototype.plugin=function(b){if(n(this,"plugin"),b)return this.ark[b];var c={};for(b in this.ark)c[b]=this.ark[b];return c},p.prototype.reserved=function(b){return/^(incoming|outgoing)::/.test(b)||b in this.reserved.events},p.prototype.reserved.events={"reconnect scheduled":1,"reconnect timeout":1,readyStateChange:1,"reconnect failed":1,reconnected:1,reconnect:1,offline:1,timeout:1,destroy:1,online:1,error:1,close:1,open:1,data:1,end:1},p.prototype.initialise=function(b){var d,c=this;c.recovery.on("reconnected",c.emits("reconnected")).on("reconnect failed",c.emits("reconnect failed",function(b){c.emit("end"),b()})).on("reconnect timeout",c.emits("reconnect timeout")).on("reconnect scheduled",c.emits("reconnect scheduled")).on("reconnect",c.emits("reconnect",function(b){c.emit("outgoing::reconnect"),b()})),c.on("outgoing::open",function(){var b=c.readyState;c.readyState=p.OPENING,b!==c.readyState&&c.emit("readyStateChange","opening"),d=+new Date}),c.on("incoming::open",function(){var b=c.readyState;if(c.recovery.reconnecting()&&c.recovery.reconnected(),c.writable=!0,c.readable=!0,c.online||(c.online=!0,c.emit("online")),c.readyState=p.OPEN,b!==c.readyState&&c.emit("readyStateChange","open"),c.heartbeat(),c.buffer.length){var d=c.buffer.slice(),e=d.length,f=0;for(c.buffer.length=0;f<e;f++)c._write(d[f])}c.emit("open")}),c.on("incoming::ping",function(b){c.online=!0,c.heartbeat(),c.emit("outgoing::pong",b),c._write("primus::pong::"+b)}),c.on("incoming::error",function(b){var d=c.timers.active("connect"),e=b;if("string"==typeof b)e=new Error(b);else if(!(b instanceof Error)&&"object"==typeof b){e=new Error(b.message||b.reason);for(var f in b)Object.prototype.hasOwnProperty.call(b,f)&&(e[f]=b[f])}if(c.recovery.reconnecting())return c.recovery.reconnected(e);c.listeners("error").length&&c.emit("error",e),d&&(~c.options.strategy.indexOf("timeout")?c.recovery.reconnect():c.end())}),c.on("incoming::data",function(b){c.decoder(b,function(d,e){if(d)return c.listeners("error").length&&c.emit("error",d);c.protocol(e)||c.transforms(c,c,"incoming",e,b)})}),c.on("incoming::end",function(){var b=c.readyState;return c.disconnect?(c.disconnect=!1,c.end()):(c.readyState=p.CLOSED,b!==c.readyState&&c.emit("readyStateChange","end"),c.timers.active("connect")&&c.end(),b!==p.OPEN?!!c.recovery.reconnecting()&&c.recovery.reconnect():(this.writable=!1,this.readable=!1,this.timers.clear(),c.emit("close"),~c.options.strategy.indexOf("disconnect")?c.recovery.reconnect():(c.emit("outgoing::end"),void c.emit("end"))))}),c.client();for(var e in c.ark)c.ark[e].call(c,c,b);return c.NETWORK_EVENTS?(c.offlineHandler=function(){c.online&&(c.online=!1,c.emit("offline"),c.end(),c.recovery.reset())},c.onlineHandler=function(){c.online||(c.online=!0,c.emit("online"),~c.options.strategy.indexOf("online")&&c.recovery.reconnect())},window.addEventListener?(window.addEventListener("offline",c.offlineHandler,!1),window.addEventListener("online",c.onlineHandler,!1)):document.body.attachEvent&&(document.body.attachEvent("onoffline",c.offlineHandler),document.body.attachEvent("ononline",c.onlineHandler)),c):c},p.prototype.protocol=function(b){if("string"!=typeof b||0!==b.indexOf("primus::"))return!1;var c=b.indexOf(":",8),d=b.slice(c+2);switch(b.slice(8,c)){case"ping":this.emit("incoming::ping",+d);break;case"server":"close"===d&&(this.disconnect=!0);break;case"id":this.emit("incoming::id",d);break;default:return!1}return!0},p.prototype.transforms=function(b,c,d,e,f){var g={data:e},h=b.transformers[d];return function a(b,d){var e=h[b++];if(!e)return d();if(1===e.length){if(!1===e.call(c,g))return;return a(b,d)}e.call(c,g,function(f,g){if(f)return c.emit("error",f);!1!==g&&a(b,d)})}(0,function(){if("incoming"===d)return c.emit("data",g.data,f);c._write(g.data)}),this},p.prototype.id=function(b){return this.socket&&this.socket.id?b(this.socket.id):(this._write("primus::id::"),this.once("incoming::id",b))},p.prototype.open=function(){return n(this,"open"),!this.recovery.reconnecting()&&this.options.timeout&&this.timeout(),this.emit("outgoing::open"),this},p.prototype.write=function(b){return n(this,"write"),this.transforms(this,this,"outgoing",b),!0},p.prototype._write=function(b){var c=this;return p.OPEN!==c.readyState?(this.buffer.length===this.options.queueSize&&this.buffer.splice(0,1),this.buffer.push(b),!1):(c.encoder(b,function(b,d){if(b)return c.listeners("error").length&&c.emit("error",b);"string"==typeof d&&(~d.indexOf("\u2028")&&(d=d.replace(l,"\\u2028")),~d.indexOf("\u2029")&&(d=d.replace(m,"\\u2029"))),c.emit("outgoing::data",d)}),!0)},p.prototype.heartbeat=function(){return this.options.pingTimeout?(this.timers.clear("heartbeat"),this.timers.setTimeout("heartbeat",function(){this.online&&(this.online=!1,this.emit("offline"),this.emit("incoming::end"))},this.options.pingTimeout),this):this},p.prototype.timeout=function(){function c(){b.removeListener("error",c).removeListener("open",c).removeListener("end",c).timers.clear("connect")}var b=this;return b.timers.setTimeout("connect",function(){c(),b.readyState===p.OPEN||b.recovery.reconnecting()||(b.emit("timeout"),~b.options.strategy.indexOf("timeout")?b.recovery.reconnect():b.end())},b.options.timeout),b.on("error",c).on("open",c).on("end",c)},p.prototype.end=function(b){if(n(this,"end"),this.readyState===p.CLOSED&&!this.timers.active("connect")&&!this.timers.active("open"))return this.recovery.reconnecting()&&(this.recovery.reset(),this.emit("end")),this;void 0!==b&&this.write(b),this.writable=!1,this.readable=!1;var c=this.readyState;return this.readyState=p.CLOSED,c!==this.readyState&&this.emit("readyStateChange","end"),this.timers.clear(),this.emit("outgoing::end"),this.emit("close"),this.emit("end"),this},p.prototype.destroy=j("url timers options recovery socket transport transformers",{before:"end",after:["removeAllListeners",function(){this.NETWORK_EVENTS&&(window.addEventListener?(window.removeEventListener("offline",this.offlineHandler),window.removeEventListener("online",this.onlineHandler)):document.body.attachEvent&&(document.body.detachEvent("onoffline",this.offlineHandler),document.body.detachEvent("ononline",this.onlineHandler)))}]}),p.prototype.clone=function(b){return this.merge({},b)},p.prototype.merge=function(b){for(var d,e,c=1;c<arguments.length;c++){e=arguments[c];for(d in e)Object.prototype.hasOwnProperty.call(e,d)&&(b[d]=e[d])}return b},p.prototype.parse=a("url-parse"),p.prototype.querystring=h.parse,p.prototype.querystringify=h.stringify,p.prototype.uri=function(b){var c=this.url,d=[],e=!1;b.query&&(e=!0),b=b||{},b.protocol="protocol"in b?b.protocol:"http:",b.query=!(!c.query||!e)&&c.query.slice(1),b.secure="secure"in b?b.secure:"https:"===c.protocol||"wss:"===c.protocol,b.auth="auth"in b?b.auth:c.auth,b.pathname="pathname"in b?b.pathname:this.pathname,b.port="port"in b?+b.port:+c.port||(b.secure?443:80),this.emit("outgoing::url",b);var f=this.querystring(b.query||"");return f._primuscb=k(),b.query=this.querystringify(f),d.push(b.secure?b.protocol.replace(":","s:"):b.protocol,""),d.push(b.auth?b.auth+"@"+c.host:c.host),b.pathname&&d.push(b.pathname.slice(1)),e?d[d.length-1]+="?"+b.query:delete b.query,b.object?b:d.join("/")},p.prototype.transform=function(b,c){return n(this,"transform"),b in this.transformers?(this.transformers[b].push(c),this):this.critical(new Error("Invalid transformer type"))},p.prototype.critical=function(b){if(this.emit("error",b))return this;throw b},p.connect=function(b,c){return new p(b,c)},p.EventEmitter=e,p.prototype.client=function(){var c,b=this,d=function(){if("undefined"!=typeof WebSocket)return WebSocket;if("undefined"!=typeof MozWebSocket)return MozWebSocket;try{return p.requires("ws")}catch(a){}}();if(!d)return b.critical(new Error("Missing required `ws` module. Please run `npm install --save ws`"));b.on("outgoing::open",function(){b.emit("outgoing::end");try{var e={protocol:"ws+unix:"===b.url.protocol?"ws+unix:":"ws:",query:!0};3===d.length?("ws+unix:"===e.protocol&&(e.pathname=b.url.pathname+":"+b.pathname),b.socket=c=new d(b.uri(e),[],b.transport)):(b.socket=c=new d(b.uri(e)),c.binaryType="arraybuffer")}catch(a){return b.emit("error",a)}c.onopen=b.emits("incoming::open"),c.onerror=b.emits("incoming::error"),c.onclose=b.emits("incoming::end"),c.onmessage=b.emits("incoming::data",function(b,c){b(void 0,c.data)})}),b.on("outgoing::data",function(e){if(c&&c.readyState===d.OPEN)try{c.send(e)}catch(a){b.emit("incoming::error",a)}}),b.on("outgoing::reconnect",function(){b.emit("outgoing::open")}),b.on("outgoing::end",function(){c&&(c.onerror=c.onopen=c.onclose=c.onmessage=function(){},c.close(),c=null)})},p.prototype.authorization=!1,p.prototype.pathname="/primus",p.prototype.encoder=function(b,c){var d;try{b=JSON.stringify(b)}catch(a){d=a}c(d,b)},p.prototype.decoder=function(b,c){var d;if("string"!=typeof b)return c(d,b);try{b=JSON.parse(b)}catch(a){d=a}c(d,b)},p.prototype.version="7.0.0","undefined"!=typeof document&&"undefined"!=typeof navigator){document.addEventListener&&document.addEventListener("keydown",function(b){27===b.keyCode&&b.preventDefault&&b.preventDefault()},!1);var q=(navigator.userAgent||"").toLowerCase(),r=q.match(/.+(?:rv|it|ra|ie)[\/: ](\d+)\.(\d+)(?:\.(\d+))?/)||[],s=+[r[1],r[2]].join(".");!~q.indexOf("chrome")&&~q.indexOf("safari")&&s<534.54&&(p.prototype.AVOID_WEBSOCKETS=!0)}c.exports=p},{demolish:1,emits:2,eventemitter3:3,inherits:4,querystringify:7,recovery:8,"tick-tock":11,"url-parse":12,yeast:15}]},{},[16])(16)},[]);